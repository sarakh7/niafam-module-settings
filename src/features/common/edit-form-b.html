<ul class="nav nav-tabs" id="profiles-info" role="tablist">
    <li class="nav-item">
        <a class="nav-link active" data-toggle="tab" href="#profile-tab" role="tab" aria-controls="profile"
            aria-selected="true">اطلاعات اصلی</a>
    </li>
  <!--  <li class="nav-item">
        <a class="nav-link" data-toggle="tab" href="#password-tab" role="tab" aria-controls="password"
            aria-selected="false">تغییر رمز</a>
    </li> -->
    <li class="nav-item">
        <a class="nav-link" data-toggle="tab" href="#avatar-tab" role="tab" aria-controls="avatar"
            aria-selected="false">آپلود تصویر</a>
    </li>
</ul>
<div class="tab-content" id="profile-content">
    <div class="tab-pane  show fade active in" id="profile-tab" role="tabpanel" aria-labelledby="profile-tab">
        <div class="es-row es-justify-content-md-center  es-mt-4">
            <div class="es-col-md-12 es-col-xs-12 es-col-sm-12">
                <form id="profileForm" method="post" class="form es-container form-horizontal form-container"
                    novalidate="novalidate">
                    <div class="es-hidden-body">
                        <input class="d-none" type="hidden" id="action" name="action"
                            value="save_profile_user">
                    </div>
                    <fieldset>
                        <div class="es-row es-form-group">
                            <label class="es-col-md-3 es-col-xs-12 es-col-sm-12  es-form-label">
                                نام
                            </label>
                            <div class="form-control-row es-col-md-9  es-col-xs-12 es-col-sm-12 ">
                                <input type="textbox" class="es-form-control " name="name" id="name" value="{name}" placeholder="نام"
                                    maxlength="512" readonly>
                            </div>
                        </div>
                        <div class="es-row es-form-group">
                            <label class="es-col-md-3 es-col-xs-12 es-col-sm-12  es-form-label">
                                نام خانوادگی
                            </label>
                            <div class="form-control-row es-col-md-9  es-col-xs-12 es-col-sm-12 ">
                                <input type="textbox" class="es-form-control" name="lastname" id="lastname" value="{lastname}"
                                    placeholder="نام خانوادگی" maxlength="512" readonly>
                            </div>
                        </div>
                       <div class="es-row es-form-group">
                            <label class="es-col-md-3 es-col-xs-12 es-col-sm-12  es-form-label">
                                کد ملی
                            </label>
                            <div class="form-control-row es-col-md-9  es-col-xs-12 es-col-sm-12 ">
                                <input type="textbox" class="es-form-control" name="national_code" id="national_code"
                                    placeholder="کد ملی" maxlength="512" dir="ltr"  value="{national_code}" readonly>
                            </div>
                        </div>
                        <div class="es-row es-form-group">
                            <label class="es-col-md-3 es-col-xs-12 es-col-sm-12  es-form-label">
                                ایمیل
                            </label>
                            <div class="form-control-row es-col-md-9  es-col-xs-12 es-col-sm-12 ">
                                <input type="textbox" class="es-form-control" name="emailaddress" id="emailaddress"
                                    placeholder="ایمیل" maxlength="512" dir="ltr"  value="{email}">
                            </div>
                        </div>
                        <div class="es-row es-form-group">
                            <label class="es-col-md-3 es-col-xs-12 es-col-sm-12  es-form-label">
                                شماره تلفن همراه
                            </label>
                            <div class="form-control-row es-col-md-9  es-col-xs-12 es-col-sm-12 ">
                                <input type="textbox" class="es-form-control" name="mobile" id="mobile" value="{mobile}"
                                    placeholder="شماره تلفن همراه" maxlength="512" dir="ltr" readonly>
                            </div>
                        </div>
                        <div class="es-row es-form-group">
                            <label class="es-col-md-3 es-col-xs-12 es-col-sm-12  es-form-label">
                                تاریخ تولد
                            </label>
                            <div class="form-control-row es-col-md-9  es-col-xs-12 es-col-sm-12 ">
                                <input type="textbox" class="es-form-control" name="birthdate" id="birthdate"  value="{birthdate}"
                                    placeholder="تاریخ تولد" maxlength="512" dir="ltr" autocomplete="off" readonly>
                            </div>
                        </div>
                             <div class="es-row es-form-group">
                           <!-- <label class="es-col-md-3 es-col-xs-12 es-col-sm-12  es-form-label">
                                جنسیت
                            </label>
                            <div class="form-control-row es-col-md-9  es-col-xs-12 es-col-sm-12 ">
                                <input type="textbox" class="es-form-control" name="birthdate" id="birthdate"  value="[esprit:query:749]"
                                    placeholder="تاریخ تولد" maxlength="512" dir="ltr" autocomplete="off" readonly>
                            </div>
                        </div>
               
                        <div class="es-row es-form-group">
                            <label class="es-col-md-3 es-col-xs-12 es-col-sm-12  es-form-label">
                                وب سایت
                            </label>
                            <div class="form-control-row es-col-md-9  es-col-xs-12 es-col-sm-12 ">
                                <input type="textbox" class="es-form-control" name="website" id="website"
                                    placeholder="وب سایت" maxlength="512" dir="ltr" value="{website}">
                            </div>
                        </div>
                        <div class="es-row es-form-group">
                            <label class="es-col-md-3 es-col-xs-12 es-col-sm-12  es-form-label">
                                لینکدین
                            </label>
                            <div class="form-control-row es-col-md-9  es-col-xs-12 es-col-sm-12 ">
                                <input type="textbox" class="es-form-control" name="linkedin" id="linkedin"
                                    placeholder="لینکدین" maxlength="512" dir="ltr" value="{linkedin}">
                            </div>
                        </div>
                        <div class="es-row es-form-group">
                            <label class="es-col-md-3 es-col-xs-12 es-col-sm-12  es-form-label">
                                اینستاگرام
                            </label>
                            <div class="form-control-row es-col-md-9  es-col-xs-12 es-col-sm-12 ">
                                <input type="textbox" class="es-form-control" name="instagram" id="instagram"
                                    placeholder="اینستاگرام" maxlength="512" dir="ltr" value="{instagram}">
                            </div>
                        </div>
                        <div class="es-row es-form-group">
                            <label class="es-col-md-3 es-col-xs-12 es-col-sm-12  es-form-label">
                                تلگرام
                            </label>
                            <div class="form-control-row es-col-md-9  es-col-xs-12 es-col-sm-12 ">
                                <input type="textbox" class="es-form-control" name="telegram" id="telegram"
                                    placeholder="تلگرام" maxlength="512" dir="ltr" value="{telegram}">
                            </div>
                        </div>
                        <div class="es-row es-form-group">
                            <label class="es-col-md-3 es-col-xs-12 es-col-sm-12  es-form-label">
                                توضیحات
                            </label>
                            <div class="form-control-row es-col-md-9  es-col-xs-12 es-col-sm-12 ">
                                <textarea class="es-form-control" name="description" id="description"
                                    placeholder="توضیحات" maxlength="512">{description}</textarea>
                            </div>
                        </div>
                        <div class="es-row es-form-group">
                            <div class="form-control-row es-col-md-12  es-col-xs-12 es-col-sm-12 ">
                                <button type="submit" class="es-btn es-btn-primary "><i class="fa fa-check"> </i> ثبت
                                    فرم</button>
                            </div> -->
                        </div>
                    </fieldset>
                </form>
            </div>
        </div>

    </div>
    <div class="tab-pane fade" id="password-tab" role="tabpanel" aria-labelledby="password-tab">

        <div class="es-row es-justify-content-md-center  es-mt-4">
            <div class="es-col-md-12 es-col-xs-12 es-col-sm-12">
                <form id="changePassForm" method="post" class="form es-container form-horizontal form-container"
                    novalidate="novalidate">
                    <div class="es-hidden-body">
                        <input class="d-none" type="hidden" id="action" name="action" value="change_pass">
                    </div>
                    <fieldset>
                      <div class="alert alert-success" role="alert">
لطفاً برای گذرواژۀ جدید خود، از ترکیبِ حروف بزرگ، حروف کوچک، اعداد و کاراکترهای خاص(@!#$%^&*)، یک عبارت حداقل 8 کاراکتری را تعیین نمایید.
</div>
                        <div class="es-row es-form-group">
                            <label class="es-col-md-3 es-col-xs-12 es-col-sm-12  es-form-label">
                                رمز ورود قبلی
                            </label>
                            <div class="form-control-row es-col-md-9  es-col-xs-12 es-col-sm-12 ">
                                <input type="password" class="es-form-control" name="oldpass" id="oldpass"
                                    placeholder="رمز ورود قبلی " maxlength="512" dir="ltr" autocomplete="off">
                            </div>
                        </div>
                        <div class="es-row es-form-group">
                            <label class="es-col-md-3 es-col-xs-12 es-col-sm-12  es-form-label">
                                رمز ورود جدید
                            </label>
                            <div class="form-control-row es-col-md-9  es-col-xs-12 es-col-sm-12 ">
                                <input type="password" class="es-form-control " name="newpass" id="newpass"
                                    placeholder="رمز ورود جدید" maxlength="512" dir="ltr" autocomplete="off">
                            </div>
                        </div>
                        <div class="es-row es-form-group">
                            <label class="es-col-md-3 es-col-xs-12 es-col-sm-12  es-form-label">
                                تکرار رمز ورود
                            </label>
                            <div class="form-control-row es-col-md-9  es-col-xs-12 es-col-sm-12 ">
                                <input type="password" class="es-form-control " name="newpassrepeat" id="newpassrepeat"
                                    placeholder=" تکرار رمز ورود" maxlength="512" dir="ltr" autocomplete="off">
                            </div>
                        </div>
                        <div class="es-row es-form-group">
                            <div class="form-control-row es-col-md-12  es-col-xs-12 es-col-sm-12 ">
                                <button type="submit" class="es-btn es-btn-primary "><i class="fa fa-check"> </i> ثبت
                                    فرم</button>
                            </div>
                        </div>
                    </fieldset>
                </form>
            </div>
        </div>

    </div>
    <div class="tab-pane fade " id="avatar-tab" role="tabpanel" aria-labelledby="avatar-tab">

        <div class="es-row es-justify-content-md-center  es-mt-4">
            <div class="es-col-md-12 es-col-xs-12 es-col-sm-12">
                <form id="avatarForm" method="post" class="form es-container form-horizontal form-container"
                    novalidate="novalidate">
                    <div class="es-hidden-body">
                        <input class="d-none" type="hidden" id="action" name="action"
                            value="save_profile_avatar">
                    </div>
                    <fieldset>
                        <div class="es-row es-form-group">
                            <div class="es-col-md-6">
                                <input class="ax-browse d-none" type="file" name="addpicurl-name" id="addpicurl-name">
                                <input type="text" name="picurl" id="picurl"
                                    class="es-form-control basic-maxlength dir-ltr" maxlength="512"
                                    placeholder="آدرس فایل تصویر" dir="ltr">
                            </div>
                            <div class="es-col-md-3">
                                <div>
                                    <button class="es-btn es-btn-warning es-btn-block  send-file" id="addpicurl"
                                        type="button"> <i class="fas fa-camera"></i> افزودن فایل</button>
                                </div>
                                <div class="progress">
                                    <div class="progress-bar" style="width:0%"></div>
                                </div>
                            </div>
                        </div>
                    </fieldset>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    $('#profiles-info a').on('click', function (e) {
        e.preventDefault();
        $("#profiles-info > .fade").removeClass("in")
        $($(this).attr("href")).addClass("in")
    })
    $("#profileForm").validate({
        rules: {
            name: {
                required: true
            },
            emailaddress: {
                email: true,

            },
            website: {
                url: true
            },
            lastname: {
                required: true
            }
        },
        messages: {

        }
    })
    $("#changePassForm").validate({
        rules: {
            oldpass: {
                required: true
            },
            newpass: {
                required: true,
                pwcheck:true
            },
            newpassrepeat: {
                required: true,
                equalTo: "#newpass"
            }
        },
        messages: {
            newpass: {
                pwcheck:"پسورد صحیح نیست."
            },
            newpassrepeat: {
                equalTo: "پسورد ها مشابه نیستند."
            }
        }
    })
    $("#birthdate"  )
        .persianDatepicker({
            format: "YYYY/MM/DD",
            toolbox: {
                calendarSwitch: {
                    enabled: false
                }
            },
            timePicker: {
                enabled: false
            },
             initialValueType: "persian",
            initialValue: true,
            calendarType:   "persian" ,
            persianDigit: false,
            autoClose: true,
        })
     //$("#birthdate"  ) .val("{birthdate}")
    $(".form-container").on("submit", function (e) {
        e.preventDefault();
        if (!$(this).valid()) return
        var dataToSend = {
            action: "save_profile_user",

        }, _this = this;
        $(_this).find("input,textarea,select").each(function () {

          dataToSend[$(this).attr("name")] = $(this).val()
        })
        $.ajax({
            url: "/inc/ajax.ashx",
            type: "POST",
            data: dataToSend,
            beforeSend: function () {
                $(_this).block(defaultBlockOption);

            },
            success: function () {
                $(_this).unblock(defaultBlockOption)
            },
            error: function () {
                $(_this).unblock(defaultBlockOption)
            }
        })
    })


    $(".send-file").on("click", function (e) {
        $(e.currentTarget)
            .closest(".es-form-group.es-row")
            .find(".ax-browse")
            .trigger("click");
    })
        ;
    $('input[type=file]').change(function () {
        let $parent = $(this).closest(".es-form-group.es-row");
        $(this).simpleUpload("/inc/ajax.ashx?action=change_avatar", {
            start: function (file) {
                //upload started
                $parent.find('.progress').show();
                $parent.find('.progress-bar')
                    .html("")
                    .width(0);
            },
            progress: function (progress) {
                //received progress
                $parent.find('.progress-bar')
                    .html(" (" + Math.round(progress) + "%) ")
                    .width(progress + "%");
            },
            success: function (data) {
                var parsed_data = JSON.parse(data);
                $parent.find('input.form-control').val(parsed_data.fileurl);
                setTimeout(function () {
                    $parent.find('.progress').fadeOut();
                }, 1000);

                // $('.progress-bar').width(0);
            },
            error: function (error) {
                //upload failed

            }
        });
    });
    $.validator.addMethod("pwcheck", function (value) {
        return /^(?=.*[A-z])(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])/.test(value) // consists of only these
          //  && /[a-z]/.test(value) // has a lowercase letter
           // && /\d/.test(value) // has a digit
    });
</script>