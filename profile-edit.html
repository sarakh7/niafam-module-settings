<!DOCTYPE html>
<html lang="fa">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ویرایش پروفایل - Niafam</title>
    <link rel="icon" href="/assets/img/niafam-favicon.png" type="image/x-icon" />
    <link rel="stylesheet" href="/assets/css/reset.css" />
    <link rel="stylesheet" href="/assets/css/persian-datepicker.min.css" />

    <script src="/assets/js/jquery.js"></script>
    <script src="/assets/js/persian-date.min.js"></script>
    <script src="/assets/js/persian-datepicker.js"></script>

    <style>
      @font-face {
        font-family: "niafam";
        src: url("/assets/fonts/niafam.woff?ahg0bg");
        font-weight: normal;
        font-style: normal;
        font-display: block;
      }

      @font-face {
        font-family: dana;
        src: url("/assets/fonts/DanaFaNum-Regular.woff");
        font-weight: normal;
        font-display: swap;
      }

      @font-face {
        font-family: dana;
        src: url("/assets/fonts/DanaFaNum-Bold.woff");
        font-weight: bold;
        font-display: swap;
      }

      @font-face {
        font-family: dana;
        src: url("/assets/fonts/DanaFaNum-Black.woff");
        font-weight: 900;
        font-display: swap;
      }

      @font-face {
        font-family: dana;
        src: url("/assets/fonts/DanaFaNum-Medium.woff");
        font-weight: 500;
        font-display: swap;
      }

      @font-face {
        font-family: dana;
        src: url("/assets/fonts/DanaFaNum-DemiBold.woff");
        font-weight: 600;
        font-display: swap;
      }

      @font-face {
        font-family: dana;
        src: url("/assets/fonts/DanaFaNum-ExtraBold.woff");
        font-weight: 800;
        font-display: swap;
      }

      /* en font */
      @font-face {
        font-family: Roboto;
        src: url("/assets/fonts/Roboto-Regular.woff");
        font-weight: normal;
        font-display: swap;
      }

      @font-face {
        font-family: Roboto;
        src: url("/assets/fonts/Roboto-Bold.woff");
        font-weight: bold;
        font-display: swap;
      }

      @font-face {
        font-family: Roboto;
        src: url("/assets/fonts/Roboto-Medium.woff");
        font-weight: 500;
        font-display: swap;
      }

      body {
        font-size: 16px;
        font-family: dana;
      }

      body[dir="ltr"] {
        font-family: Roboto;
      }
      ul.breadcrumb {
        padding: 10px 16px;
        list-style: none;
        margin: 0;
      }
      ul.breadcrumb li {
        display: inline;
        font-size: 18px;
      }
      ul.breadcrumb li a {
        color: #000;
        font-size: 14px;
        text-decoration: none;
      }
      ul.breadcrumb li + li:before {
        padding: 0;
        color: #000;
        content: "/ ";
      }
      ul.breadcrumb li a:hover {
        color: #01447e;
        text-decoration: underline;
      }

      /* Custom Select Styling */
      .profile-edit__select-wrapper {
        position: relative;
        display: flex;
        align-items: center;
      }

      .profile-edit__select-icon {
        position: absolute;
        right: 16px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 18px;
        color: #6b7280;
        pointer-events: none;
        z-index: 2;
        transition: color 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      body[dir="ltr"] .profile-edit__select-icon {
        left: 16px;
        right: auto;
      }

      .profile-edit__select-chevron {
        position: absolute;
        left: 16px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 14px;
        color: #9ca3af;
        pointer-events: none;
        z-index: 2;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      body[dir="ltr"] .profile-edit__select-chevron {
        right: 16px;
        left: auto;
      }

      .profile-edit__select {
        width: 100%;
        padding-right: 48px !important;
        padding-left: 48px !important;
        appearance: none;
        -webkit-appearance: none;
        -moz-appearance: none;
        background-color: #ffffff;
        background-image: none;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        font-family: dana;
        font-size: 15px;
        line-height: 1.6;
        color: #1f2937;
        border: 2px solid #e5e7eb;
        border-radius: 12px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
      }

      body[dir="ltr"] .profile-edit__select {
        font-family: Roboto;
      }

      .profile-edit__select:hover:not(:disabled) {
        border-color: #cbd5e1;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
      }

      .profile-edit__select:hover:not(:disabled) ~ .profile-edit__select-icon {
        color: #4b5563;
      }

      .profile-edit__select:hover:not(:disabled) ~ .profile-edit__select-chevron {
        color: #6b7280;
        transform: translateY(-50%) scale(1.1);
      }

      .profile-edit__select:focus {
        outline: none;
        border-color: #3b82f6;
        box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1), 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .profile-edit__select:focus ~ .profile-edit__select-icon {
        color: #3b82f6;
      }

      .profile-edit__select:focus ~ .profile-edit__select-chevron {
        color: #3b82f6;
        transform: translateY(-50%) rotate(180deg);
      }

      .profile-edit__select:disabled {
        background-color: #f9fafb;
        color: #9ca3af;
        cursor: not-allowed;
        opacity: 0.6;
        border-color: #e5e7eb;
      }

      .profile-edit__select:disabled ~ .profile-edit__select-icon,
      .profile-edit__select:disabled ~ .profile-edit__select-chevron {
        color: #d1d5db;
      }

      .profile-edit__select option {
        padding: 12px 16px;
        font-size: 15px;
        color: #1f2937;
        background-color: #ffffff;
      }

      .profile-edit__select option:hover {
        background-color: #f3f4f6;
      }

      .profile-edit__select option:disabled {
        color: #9ca3af;
      }

      /* Animation for select state change */
      @keyframes selectPulse {
        0%, 100% {
          box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.4);
        }
        50% {
          box-shadow: 0 0 0 6px rgba(59, 130, 246, 0);
        }
      }

      .profile-edit__select.select-changed {
        animation: selectPulse 0.6s ease-out;
      }

      /* Enhanced focus-visible for keyboard navigation */
      .profile-edit__select:focus-visible {
        border-color: #3b82f6;
        box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.15), 0 4px 12px rgba(0, 0, 0, 0.12);
      }

      /* Smooth transitions for all interactive states */
      .profile-edit__select,
      .profile-edit__select-icon,
      .profile-edit__select-chevron {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }
    </style>
  </head>
  <body>
    <header class="header">
      <img class="vector" src="/assets/img/niafam-logo.png" alt="Niafam Logo" width="148" height="60" />
      <nav class="auto-layout">
        <a href="#" class="text-wrapper" data-i18n="nav.contactUs">تماس با ما</a>
        <a href="#" class="text-wrapper" data-i18n="nav.organizationalPortal">پورتال سازمانی</a>
        <a href="#" class="text-wrapper" data-i18n="nav.aboutUs">درباره نیافام</a>
        <a href="#" class="style-filled"><span class="do-something" data-i18n="nav.login">ورود کاربران</span></a>
      </nav>
    </header>
    <div class="page-content-wrapper">
      <div class="page-content-breadcrumb">
        <ul class="breadcrumb" itemscope="" itemtype="http://schema.org/BreadcrumbList">
          <li itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem">
            <a itemprop="item" href="/">
              <span itemprop="name" data-i18n="breadcrumb.home">صفحه اصلی</span>
            </a>
            <meta itemprop="position" content="1" />
          </li>
          <li itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem">
            <a itemprop="item" href="/profile-edit.html">
              <span itemprop="name" data-i18n="breadcrumb.editProfile">ویرایش پروفایل</span>
            </a>
            <meta itemprop="position" content="2" />
          </li>
        </ul>
      </div>

      <!-- محتوای اصلی ویرایش پروفایل -->
      <div class="profile-edit-container">
        <div class="profile-edit">
          <div class="es-container">
            <h2 class="nes-section-title" data-i18n="profile.editProfile">ویرایش پروفایل</h2>

            <!-- تب‌های ویرایش - Pill Style -->
            <ul class="profile-edit__tabs" id="profiles-info" role="tablist">
              <li class="profile-edit__tab-item">
                <a class="profile-edit__tab-link profile-edit__tab-link--active" data-toggle="tab" href="#profile-tab" role="tab" aria-controls="profile" aria-selected="true">
                  <i class="es esprit-fi-rr-comment-user profile-edit__tab-icon"></i>
                  <span data-i18n="profile.tabs.basicInfo">اطلاعات اصلی</span>
                </a>
              </li>
              <li class="profile-edit__tab-item">
                <a class="profile-edit__tab-link" data-toggle="tab" href="#password-tab" role="tab" aria-controls="password" aria-selected="false">
                  <i class="es esprit-fi-rr-lock profile-edit__tab-icon"></i>
                  <span data-i18n="profile.tabs.changePassword">تغییر رمز</span>
                </a>
              </li>
              <li class="profile-edit__tab-item">
                <a class="profile-edit__tab-link" data-toggle="tab" href="#avatar-tab" role="tab" aria-controls="avatar" aria-selected="false">
                  <i class="es esprit-fi-rr-camera profile-edit__tab-icon"></i>
                  <span data-i18n="profile.tabs.uploadAvatar">آپلود تصویر</span>
                </a>
              </li>
            </ul>

            <!-- محتوای تب‌ها -->
            <div class="profile-edit__tab-content" id="profile-content">
              <!-- تب اطلاعات اصلی -->
              <div class="profile-edit__tab-pane profile-edit__tab-pane--active" id="profile-tab" role="tabpanel" aria-labelledby="profile-tab">
                <form id="profileForm" method="post" class="nes-form" novalidate="novalidate">
                  <input type="hidden" id="action" name="action" value="save_profile_user" />

                  <!-- Two-column grid for form fields -->
                  <div class="profile-edit__form-grid">
                    <!-- Name -->
                    <div class="nes-form-group">
                      <label class="nes-label" for="name" data-i18n="profile.form.firstName">نام</label>
                      <div class="profile-edit__input-wrapper">
                        <i class="es esprit-fi-rr-user profile-edit__input-icon"></i>
                        <input type="text" class="nes-input" name="name" id="name" value="{name}" placeholder="" data-i18n="[placeholder]profile.form.firstNamePlaceholder" maxlength="512" />
                      </div>
                      <span class="profile-edit__field-error"></span>
                    </div>

                    <!-- Last Name -->
                    <div class="nes-form-group">
                      <label class="nes-label" for="lastname" data-i18n="profile.form.lastName">نام خانوادگی</label>
                      <div class="profile-edit__input-wrapper">
                        <i class="es esprit-fi-rr-user profile-edit__input-icon"></i>
                        <input
                          type="text"
                          class="nes-input"
                          name="lastname"
                          id="lastname"
                          value="{lastname}"
                          placeholder=""
                          data-i18n="[placeholder]profile.form.lastNamePlaceholder"
                          maxlength="512"
                          autocomplete="off"
                        />
                      </div>
                      <span class="profile-edit__field-error"></span>
                    </div>

                    <!-- Email -->
                    <div class="nes-form-group">
                      <label class="nes-label" for="emailaddress" data-i18n="profile.form.email">ایمیل</label>
                      <div class="profile-edit__input-wrapper">
                        <i class="es esprit-fi-rr-envelope profile-edit__input-icon"></i>
                        <input
                          type="email"
                          class="nes-input"
                          name="emailaddress"
                          id="emailaddress"
                          placeholder=""
                          data-i18n="[placeholder]profile.form.emailPlaceholder"
                          maxlength="512"
                          dir="ltr"
                          value="{email}"
                        />
                      </div>
                      <span class="profile-edit__field-error"></span>
                    </div>

                    <!-- Mobile -->
                    <div class="nes-form-group">
                      <label class="nes-label" for="mobile" data-i18n="profile.form.mobile">شماره تلفن همراه</label>
                      <div class="profile-edit__input-wrapper">
                        <i class="es esprit-fi-rr-mobile profile-edit__input-icon"></i>
                        <input
                          type="text"
                          class="nes-input"
                          name="mobile"
                          id="mobile"
                          value="{mobile}"
                          placeholder=""
                          data-i18n="[placeholder]profile.form.mobilePlaceholder"
                          maxlength="512"
                          dir="ltr"
                          autocomplete="off"
                        />
                      </div>
                      <span class="profile-edit__field-error"></span>
                    </div>

                    <!-- Birthdate -->
                    <div class="nes-form-group">
                      <label class="nes-label" for="birthdate" data-i18n="profile.form.birthdate">تاریخ تولد</label>
                      <div class="profile-edit__input-wrapper">
                        <i class="es esprit-fi-rr-calendar profile-edit__input-icon"></i>
                        <input
                          type="text"
                          class="nes-input"
                          name="birthdate"
                          id="birthdate"
                          value="{birthdate}"
                          placeholder=""
                          data-i18n="[placeholder]profile.form.birthdatePlaceholder"
                          maxlength="512"
                          dir="ltr"
                          autocomplete="off"
                        />
                      </div>
                      <span class="profile-edit__field-error"></span>
                    </div>

                    <!-- Gender -->
                    <div class="nes-form-group">
                      <label class="nes-label" for="gender" data-i18n="profile.form.gender">جنسیت</label>
                      <select class="nes-input" name="gender" id="gender" data-gender="{gender}">
                        <option value="" data-i18n="profile.form.genderNone">بدون انتخاب</option>
                        <option value="0" {gen_woman} data-i18n="profile.form.genderWoman">زن</option>
                        <option value="1" {gen_man} data-i18n="profile.form.genderMan">مرد</option>
                      </select>
                      <span class="profile-edit__field-error"></span>
                    </div>

                    <!-- Province -->
                    <div class="nes-form-group">
                      <label class="nes-label" for="province" data-i18n="profile.form.province">استان</label>
                      <div class="profile-edit__select-wrapper">
                        <i class="es esprit-map profile-edit__select-icon"></i>
                        <select
                          class="nes-input profile-edit__select"
                          name="province"
                          id="province"
                          data-i18n="[data-placeholder]profile.form.provincePlaceholder"
                          data-placeholder="انتخاب استان"
                        >
                          <option value="" data-i18n="profile.form.provincePlaceholder">انتخاب استان</option>
                        </select>
                        <i class="es esprit-chevron-down profile-edit__select-chevron"></i>
                      </div>
                      <span class="profile-edit__field-error"></span>
                    </div>

                    <!-- City -->
                    <div class="nes-form-group">
                      <label class="nes-label" for="city" data-i18n="profile.form.city">شهر</label>
                      <div class="profile-edit__select-wrapper">
                        <i class="es esprit-map-pin profile-edit__select-icon"></i>
                        <select
                          class="nes-input profile-edit__select"
                          name="city"
                          id="city"
                          data-i18n="[data-placeholder]profile.form.cityPlaceholder"
                          data-placeholder="انتخاب شهر"
                          disabled
                        >
                          <option value="" data-i18n="profile.form.cityPlaceholder">ابتدا استان را انتخاب کنید</option>
                        </select>
                        <i class="es esprit-chevron-down profile-edit__select-chevron"></i>
                      </div>
                      <span class="profile-edit__field-error"></span>
                    </div>

                    <!-- Address (full width) -->
                    <div class="nes-form-group">
                      <label class="nes-label" for="address" data-i18n="profile.form.address">آدرس</label>
                      <textarea class="nes-input" name="address" id="address" placeholder="" data-i18n="[placeholder]profile.form.addressPlaceholder" maxlength="1024" rows="3">{address}</textarea>
                      <span class="profile-edit__field-error"></span>
                    </div>

                    <!-- Postal Code -->
                    <div class="nes-form-group">
                      <label class="nes-label" for="postalcode" data-i18n="profile.form.postalCode">کد پستی</label>
                      <div class="profile-edit__input-wrapper">
                        <i class="es esprit-hash profile-edit__input-icon"></i>
                        <input
                          type="text"
                          class="nes-input"
                          name="postalcode"
                          id="postalcode"
                          value="{postalcode}"
                          placeholder=""
                          data-i18n="[placeholder]profile.form.postalCodePlaceholder"
                          maxlength="20"
                          dir="ltr"
                        />
                      </div>
                      <span class="profile-edit__field-error"></span>
                    </div>

                    <!-- Website -->
                    <div class="nes-form-group">
                      <label class="nes-label" for="website" data-i18n="profile.form.website">وب سایت</label>
                      <div class="profile-edit__input-wrapper">
                        <i class="es esprit-fi-rr-globe profile-edit__input-icon"></i>
                        <input
                          type="url"
                          class="nes-input"
                          name="website"
                          id="website"
                          placeholder=""
                          data-i18n="[placeholder]profile.form.websitePlaceholder"
                          maxlength="512"
                          dir="ltr"
                          value="{website}"
                        />
                      </div>
                      <span class="profile-edit__field-error"></span>
                    </div>

                    <!-- LinkedIn -->
                    <div class="nes-form-group">
                      <label class="nes-label" for="linkedin" data-i18n="profile.form.linkedin">لینکدین</label>
                      <div class="profile-edit__input-wrapper">
                        <i class="es esprit-linkedin profile-edit__input-icon"></i>
                        <input
                          type="url"
                          class="nes-input"
                          name="linkedin"
                          id="linkedin"
                          placeholder=""
                          data-i18n="[placeholder]profile.form.linkedinPlaceholder"
                          maxlength="512"
                          dir="ltr"
                          value="{linkedin}"
                        />
                      </div>
                      <span class="profile-edit__field-error"></span>
                    </div>

                    <!-- Instagram -->
                    <div class="nes-form-group">
                      <label class="nes-label" for="instagram" data-i18n="profile.form.instagram">اینستاگرام</label>
                      <div class="profile-edit__input-wrapper">
                        <i class="es esprit-Instagram profile-edit__input-icon"></i>
                        <input
                          type="url"
                          class="nes-input"
                          name="instagram"
                          id="instagram"
                          placeholder=""
                          data-i18n="[placeholder]profile.form.instagramPlaceholder"
                          maxlength="512"
                          dir="ltr"
                          value="{instagram}"
                        />
                      </div>
                      <span class="profile-edit__field-error"></span>
                    </div>

                    <!-- Telegram -->
                    <div class="nes-form-group">
                      <label class="nes-label" for="telegram" data-i18n="profile.form.telegram">تلگرام</label>
                      <div class="profile-edit__input-wrapper">
                        <i class="es esprit-telegram profile-edit__input-icon"></i>
                        <input
                          type="url"
                          class="nes-input"
                          name="telegram"
                          id="telegram"
                          placeholder=""
                          data-i18n="[placeholder]profile.form.telegramPlaceholder"
                          maxlength="512"
                          dir="ltr"
                          value="{telegram}"
                        />
                      </div>
                      <span class="profile-edit__field-error"></span>
                    </div>
                  </div>

                  <!-- Description (full width) -->
                  <div class="nes-form-group">
                    <label class="nes-label" for="description" data-i18n="profile.form.description">توضیحات</label>
                    <textarea class="nes-input" name="description" id="description" placeholder="" data-i18n="[placeholder]profile.form.descriptionPlaceholder" maxlength="512" rows="4">
{description}</textarea
                    >
                    <span class="profile-edit__field-error"></span>
                  </div>

                  <div class="form-message"></div>

                  <div class="nes-form-actions">
                    <button type="submit" class="nes-btn nes-btn-primary">
                      <i class="es esprit-check"></i>
                      <span data-i18n="profile.form.submit">ثبت فرم</span>
                    </button>
                  </div>
                </form>
              </div>

              <!-- تب تغییر رمز -->
              <div class="profile-edit__tab-pane" id="password-tab" role="tabpanel" aria-labelledby="password-tab">
                <form id="changePassForm" method="post" class="nes-form" novalidate="novalidate">
                  <input type="hidden" id="action" name="action" value="change_pass" />

                  <!-- Old Password -->
                  <div class="nes-form-group">
                    <label class="nes-label" for="oldpass" data-i18n="profile.form.oldPassword">رمز ورود قبلی</label>
                    <div class="profile-edit__password-wrapper">
                      <i class="es esprit-fi-rr-lock profile-edit__input-icon"></i>
                      <input
                        type="password"
                        class="nes-input profile-edit__password-input"
                        name="oldpass"
                        id="oldpass"
                        placeholder=""
                        data-i18n="[placeholder]profile.form.oldPasswordPlaceholder"
                        maxlength="512"
                        dir="ltr"
                        autocomplete="off"
                      />
                      <button type="button" class="profile-edit__password-toggle" data-target="oldpass" aria-label="Toggle password visibility">
                        <i class="es esprit-eye"></i>
                      </button>
                    </div>
                    <span class="profile-edit__field-error"></span>
                  </div>

                  <!-- New Password -->
                  <div class="nes-form-group">
                    <label class="nes-label" for="newpass" data-i18n="profile.form.newPassword">رمز ورود جدید</label>
                    <div class="profile-edit__password-wrapper">
                      <i class="es esprit-fi-rr-lock profile-edit__input-icon"></i>
                      <input
                        type="password"
                        class="nes-input profile-edit__password-input"
                        name="newpass"
                        id="newpass"
                        placeholder=""
                        data-i18n="[placeholder]profile.form.newPasswordPlaceholder"
                        maxlength="512"
                        dir="ltr"
                        autocomplete="off"
                      />
                      <button type="button" class="profile-edit__password-toggle" data-target="newpass" aria-label="Toggle password visibility">
                        <i class="es esprit-eye"></i>
                      </button>
                    </div>
                    <!-- Password strength meter -->
                    <div class="profile-edit__password-strength">
                      <div class="profile-edit__password-strength-bar" id="password-strength-bar"></div>
                    </div>
                    <div class="profile-edit__password-hint" id="password-hint">
                      <span data-i18n="profile.form.passwordRequirements">رمز عبور باید شامل حروف بزرگ، کوچک و عدد باشد</span>
                    </div>
                    <span class="profile-edit__field-error"></span>
                  </div>

                  <!-- Repeat New Password -->
                  <div class="nes-form-group">
                    <label class="nes-label" for="newpassrepeat" data-i18n="profile.form.repeatPassword">تکرار رمز ورود</label>
                    <div class="profile-edit__password-wrapper">
                      <i class="es esprit-fi-rr-lock profile-edit__input-icon"></i>
                      <input
                        type="password"
                        class="nes-input profile-edit__password-input"
                        name="newpassrepeat"
                        id="newpassrepeat"
                        placeholder=""
                        data-i18n="[placeholder]profile.form.repeatPasswordPlaceholder"
                        maxlength="512"
                        dir="ltr"
                        autocomplete="off"
                      />
                      <button type="button" class="profile-edit__password-toggle" data-target="newpassrepeat" aria-label="Toggle password visibility">
                        <i class="es esprit-eye"></i>
                      </button>
                    </div>
                    <span class="profile-edit__field-error"></span>
                  </div>

                  <div class="form-message"></div>

                  <div class="nes-form-actions">
                    <button type="submit" class="nes-btn nes-btn-primary">
                      <i class="es esprit-check"></i>
                      <span data-i18n="profile.form.submit">ثبت فرم</span>
                    </button>
                  </div>
                </form>
              </div>

              <!-- تب آپلود تصویر -->
              <div class="profile-edit__tab-pane" id="avatar-tab" role="tabpanel" aria-labelledby="avatar-tab">
                <form id="avatarForm" method="post" class="nes-form" novalidate="novalidate">
                  <input type="hidden" id="action" name="action" value="save_profile_avatar" />

                  <div class="profile-edit__avatar-upload-container">
                    <!-- Avatar Preview -->
                    <div class="profile-edit__avatar-preview">
                      <img src="/uploads/sys/profiles/128/{userunicid}.jpg" alt="Current Avatar" class="profile-edit__avatar-image" id="avatar-preview-image" />
                      <div class="profile-edit__avatar-overlay" id="avatar-overlay">
                        <i class="es esprit-camera"></i>
                      </div>
                    </div>

                    <!-- File Input (hidden) -->
                    <input class="d-none" type="file" name="addpicurl-name" id="addpicurl-name" accept="image/*" />

                    <!-- Upload Button -->
                    <button class="nes-btn nes-btn-primary profile-edit__avatar-button" id="addpicurl" type="button">
                      <i class="es esprit-camera"></i>
                      <span data-i18n="profile.form.chooseAvatar">انتخاب تصویر</span>
                    </button>

                    <!-- File Info -->
                    <div class="profile-edit__file-info" id="file-info"></div>

                    <!-- Progress Bar -->
                    <div class="profile-edit__progress" id="upload-progress" style="display: none">
                      <div class="profile-edit__progress-bar" id="progress-bar" style="width: 0%"></div>
                      <span class="profile-edit__progress-text" id="progress-text">0%</span>
                    </div>

                    <!-- Messages -->
                    <div class="form-message"></div>

                    <!-- Help Text -->
                    <p class="profile-edit__help-text">
                      <span data-i18n="profile.form.avatarHelp">تصویر باید کمتر از 5MB و با فرمت JPG, PNG یا GIF باشد</span>
                    </p>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Province and City Data
      const locationData = {
        provinces: [
          { id: 1, name: 'تهران', nameEn: 'Tehran' },
          { id: 2, name: 'اصفهان', nameEn: 'Isfahan' },
          { id: 3, name: 'فارس', nameEn: 'Fars' },
          { id: 4, name: 'خراسان رضوی', nameEn: 'Razavi Khorasan' },
          { id: 5, name: 'خوزستان', nameEn: 'Khuzestan' },
          { id: 6, name: 'آذربایجان شرقی', nameEn: 'East Azerbaijan' },
          { id: 7, name: 'مازندران', nameEn: 'Mazandaran' },
          { id: 8, name: 'گیلان', nameEn: 'Gilan' },
          { id: 9, name: 'کرمان', nameEn: 'Kerman' },
          { id: 10, name: 'البرز', nameEn: 'Alborz' },
          { id: 11, name: 'همدان', nameEn: 'Hamadan' },
          { id: 12, name: 'کرمانشاه', nameEn: 'Kermanshah' },
          { id: 13, name: 'یزد', nameEn: 'Yazd' },
          { id: 14, name: 'قم', nameEn: 'Qom' },
          { id: 15, name: 'سمنان', nameEn: 'Semnan' }
        ],
        cities: {
          1: [ // تهران
            { id: 101, name: 'تهران', nameEn: 'Tehran' },
            { id: 102, name: 'شهریار', nameEn: 'Shahriar' },
            { id: 103, name: 'ری', nameEn: 'Rey' },
            { id: 104, name: 'ورامین', nameEn: 'Varamin' },
            { id: 105, name: 'اسلامشهر', nameEn: 'Eslamshahr' },
            { id: 106, name: 'پاکدشت', nameEn: 'Pakdasht' },
            { id: 107, name: 'دماوند', nameEn: 'Damavand' },
            { id: 108, name: 'شمیرانات', nameEn: 'Shemiranat' }
          ],
          2: [ // اصفهان
            { id: 201, name: 'اصفهان', nameEn: 'Isfahan' },
            { id: 202, name: 'کاشان', nameEn: 'Kashan' },
            { id: 203, name: 'نجف آباد', nameEn: 'Najafabad' },
            { id: 204, name: 'خمینی شهر', nameEn: 'Khomeyni Shahr' },
            { id: 205, name: 'شاهین شهر', nameEn: 'Shahin Shahr' },
            { id: 206, name: 'فلاورجان', nameEn: 'Falavarjan' },
            { id: 207, name: 'نائین', nameEn: 'Naein' },
            { id: 208, name: 'گلپایگان', nameEn: 'Golpayegan' }
          ],
          3: [ // فارس
            { id: 301, name: 'شیراز', nameEn: 'Shiraz' },
            { id: 302, name: 'مرودشت', nameEn: 'Marvdasht' },
            { id: 303, name: 'جهرم', nameEn: 'Jahrom' },
            { id: 304, name: 'فسا', nameEn: 'Fasa' },
            { id: 305, name: 'کازرون', nameEn: 'Kazerun' },
            { id: 306, name: 'لار', nameEn: 'Lar' },
            { id: 307, name: 'داراب', nameEn: 'Darab' },
            { id: 308, name: 'آباده', nameEn: 'Abadeh' }
          ],
          4: [ // خراسان رضوی
            { id: 401, name: 'مشهد', nameEn: 'Mashhad' },
            { id: 402, name: 'نیشابور', nameEn: 'Neyshabur' },
            { id: 403, name: 'سبزوار', nameEn: 'Sabzevar' },
            { id: 404, name: 'تربت حیدریه', nameEn: 'Torbat-e Heydarieh' },
            { id: 405, name: 'قوچان', nameEn: 'Quchan' },
            { id: 406, name: 'کاشمر', nameEn: 'Kashmar' },
            { id: 407, name: 'گناباد', nameEn: 'Gonabad' },
            { id: 408, name: 'چناران', nameEn: 'Chenaran' }
          ],
          5: [ // خوزستان
            { id: 501, name: 'اهواز', nameEn: 'Ahvaz' },
            { id: 502, name: 'آبادان', nameEn: 'Abadan' },
            { id: 503, name: 'خرمشهر', nameEn: 'Khorramshahr' },
            { id: 504, name: 'دزفول', nameEn: 'Dezful' },
            { id: 505, name: 'بهبهان', nameEn: 'Behbahan' },
            { id: 506, name: 'اندیمشک', nameEn: 'Andimeshk' },
            { id: 507, name: 'شوشتر', nameEn: 'Shushtar' },
            { id: 508, name: 'ماهشهر', nameEn: 'Mahshahr' }
          ],
          6: [ // آذربایجان شرقی
            { id: 601, name: 'تبریز', nameEn: 'Tabriz' },
            { id: 602, name: 'مراغه', nameEn: 'Maragheh' },
            { id: 603, name: 'مرند', nameEn: 'Marand' },
            { id: 604, name: 'میانه', nameEn: 'Mianeh' },
            { id: 605, name: 'بناب', nameEn: 'Bonab' },
            { id: 606, name: 'سراب', nameEn: 'Sarab' },
            { id: 607, name: 'شبستر', nameEn: 'Shabestar' },
            { id: 608, name: 'هشترود', nameEn: 'Hashtrud' }
          ],
          7: [ // مازندران
            { id: 701, name: 'ساری', nameEn: 'Sari' },
            { id: 702, name: 'بابل', nameEn: 'Babol' },
            { id: 703, name: 'آمل', nameEn: 'Amol' },
            { id: 704, name: 'قائم شهر', nameEn: 'Qaem Shahr' },
            { id: 705, name: 'بابلسر', nameEn: 'Babolsar' },
            { id: 706, name: 'نور', nameEn: 'Nur' },
            { id: 707, name: 'نوشهر', nameEn: 'Nowshahr' },
            { id: 708, name: 'تنکابن', nameEn: 'Tonekabon' }
          ],
          8: [ // گیلان
            { id: 801, name: 'رشت', nameEn: 'Rasht' },
            { id: 802, name: 'بندر انزلی', nameEn: 'Bandar Anzali' },
            { id: 803, name: 'لاهیجان', nameEn: 'Lahijan' },
            { id: 804, name: 'لنگرود', nameEn: 'Langarud' },
            { id: 805, name: 'رودسر', nameEn: 'Rudsar' },
            { id: 806, name: 'آستارا', nameEn: 'Astara' },
            { id: 807, name: 'تالش', nameEn: 'Talesh' },
            { id: 808, name: 'صومعه سرا', nameEn: 'Sowme\'eh Sara' }
          ],
          9: [ // کرمان
            { id: 901, name: 'کرمان', nameEn: 'Kerman' },
            { id: 902, name: 'رفسنجان', nameEn: 'Rafsanjan' },
            { id: 903, name: 'جیرفت', nameEn: 'Jiroft' },
            { id: 904, name: 'سیرجان', nameEn: 'Sirjan' },
            { id: 905, name: 'بم', nameEn: 'Bam' },
            { id: 906, name: 'زرند', nameEn: 'Zarand' },
            { id: 907, name: 'شهربابک', nameEn: 'Shahrbabak' },
            { id: 908, name: 'بافت', nameEn: 'Baft' }
          ],
          10: [ // البرز
            { id: 1001, name: 'کرج', nameEn: 'Karaj' },
            { id: 1002, name: 'نظرآباد', nameEn: 'Nazarabad' },
            { id: 1003, name: 'ساوجبلاغ', nameEn: 'Savojbolagh' },
            { id: 1004, name: 'اشتهارد', nameEn: 'Eshtehard' },
            { id: 1005, name: 'فردیس', nameEn: 'Fardis' },
            { id: 1006, name: 'طالقان', nameEn: 'Taleqan' },
            { id: 1007, name: 'هشتگرد', nameEn: 'Hashtgerd' },
            { id: 1008, name: 'محمدشهر', nameEn: 'Mohammadshahr' }
          ],
          11: [ // همدان
            { id: 1101, name: 'همدان', nameEn: 'Hamadan' },
            { id: 1102, name: 'ملایر', nameEn: 'Malayer' },
            { id: 1103, name: 'نهاوند', nameEn: 'Nahavand' },
            { id: 1104, name: 'تویسرکان', nameEn: 'Tuyserkan' },
            { id: 1105, name: 'کبودرآهنگ', nameEn: 'Kabudarahang' },
            { id: 1106, name: 'رزن', nameEn: 'Razan' },
            { id: 1107, name: 'اسدآباد', nameEn: 'Asadabad' },
            { id: 1108, name: 'بهار', nameEn: 'Bahar' }
          ],
          12: [ // کرمانشاه
            { id: 1201, name: 'کرمانشاه', nameEn: 'Kermanshah' },
            { id: 1202, name: 'اسلام آباد غرب', nameEn: 'Eslamabad-e Gharb' },
            { id: 1203, name: 'پاوه', nameEn: 'Paveh' },
            { id: 1204, name: 'جوانرود', nameEn: 'Javanrud' },
            { id: 1205, name: 'سنقر', nameEn: 'Sonqor' },
            { id: 1206, name: 'هرسین', nameEn: 'Harsin' },
            { id: 1207, name: 'کنگاور', nameEn: 'Kangavar' },
            { id: 1208, name: 'صحنه', nameEn: 'Sahneh' }
          ],
          13: [ // یزد
            { id: 1301, name: 'یزد', nameEn: 'Yazd' },
            { id: 1302, name: 'اردکان', nameEn: 'Ardakan' },
            { id: 1303, name: 'میبد', nameEn: 'Meybod' },
            { id: 1304, name: 'مهریز', nameEn: 'Mehriz' },
            { id: 1305, name: 'ابرکوه', nameEn: 'Abarkuh' },
            { id: 1306, name: 'بافق', nameEn: 'Bafq' },
            { id: 1307, name: 'تفت', nameEn: 'Taft' },
            { id: 1308, name: 'اشکذر', nameEn: 'Ashkezar' }
          ],
          14: [ // قم
            { id: 1401, name: 'قم', nameEn: 'Qom' },
            { id: 1402, name: 'جعفریه', nameEn: 'Jafarieh' },
            { id: 1403, name: 'دستجرد', nameEn: 'Dastjerd' },
            { id: 1404, name: 'سلفچگان', nameEn: 'Salafchegan' },
            { id: 1405, name: 'قنوات', nameEn: 'Qanavat' }
          ],
          15: [ // سمنان
            { id: 1501, name: 'سمنان', nameEn: 'Semnan' },
            { id: 1502, name: 'شاهرود', nameEn: 'Shahroud' },
            { id: 1503, name: 'دامغان', nameEn: 'Damghan' },
            { id: 1504, name: 'گرمسار', nameEn: 'Garmsar' },
            { id: 1505, name: 'مهدی شهر', nameEn: 'Mahdi Shahr' },
            { id: 1506, name: 'سرخه', nameEn: 'Sorkheh' }
          ]
        }
      };

      // Initialize selects
      function initializeLocationSelects() {
        const provinceSelect = document.getElementById('province');
        const citySelect = document.getElementById('city');

        if (!provinceSelect || !citySelect) return;

        // Populate provinces
        locationData.provinces.forEach(province => {
          const option = document.createElement('option');
          option.value = province.id;
          option.textContent = province.name;
          option.setAttribute('data-name-en', province.nameEn);
          provinceSelect.appendChild(option);
        });

        // Province change handler
        provinceSelect.addEventListener('change', function() {
          const provinceId = parseInt(this.value);

          // Reset and disable city select
          citySelect.innerHTML = '<option value="">انتخاب شهر</option>';
          citySelect.disabled = !provinceId;

          if (provinceId && locationData.cities[provinceId]) {
            // Populate cities for selected province
            locationData.cities[provinceId].forEach(city => {
              const option = document.createElement('option');
              option.value = city.id;
              option.textContent = city.name;
              option.setAttribute('data-name-en', city.nameEn);
              citySelect.appendChild(option);
            });

            // Enable city select
            citySelect.disabled = false;

            // Add pulse animation
            this.classList.add('select-changed');
            setTimeout(() => this.classList.remove('select-changed'), 600);
          }

          // Reset city value
          citySelect.value = '';
        });

        // Add pulse animation on city change
        citySelect.addEventListener('change', function() {
          if (this.value) {
            this.classList.add('select-changed');
            setTimeout(() => this.classList.remove('select-changed'), 600);
          }
        });

        // Optional: Set initial values if they exist (for edit mode)
        // This would be populated by your backend when editing existing profile
        const initialProvinceId = provinceSelect.getAttribute('data-initial-value');
        const initialCityId = citySelect.getAttribute('data-initial-value');

        if (initialProvinceId) {
          provinceSelect.value = initialProvinceId;
          provinceSelect.dispatchEvent(new Event('change'));

          if (initialCityId) {
            // Wait for cities to populate, then set city
            setTimeout(() => {
              citySelect.value = initialCityId;
            }, 50);
          }
        }
      }

      // Initialize when DOM is ready
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initializeLocationSelects);
      } else {
        initializeLocationSelects();
      }
    </script>

    <script>
      /**
       * Backend submission functions for profile forms
       * These functions handle AJAX/fetch requests to the server
       */

      /**
       * Submit profile form data to backend
       * @param {object} data - Form data with action: 'save_profile_user'
       * @returns {Promise<object>} Response from server
       */
      window.submitProfileData = async function(data) {
        const response = await fetch('/inc/ajax.ashx', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
          },
          body: new URLSearchParams(data),
        });

        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }

        return await response.json();
      };

      /**
       * Submit password change to backend
       * @param {object} data - Form data with action: 'change_pass'
       * @returns {Promise<object>} Response from server
       */
      window.submitPasswordChangeData = async function(data) {
        const response = await fetch('/inc/ajax.ashx', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
          },
          body: new URLSearchParams(data),
        });

        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }

        return await response.json();
      };

      /**
       * Upload avatar file to server using jQuery simpleUpload
       * @param {File} file - File to upload
       * @param {HTMLInputElement} fileInput - File input element (for simpleUpload)
       */
      window.uploadAvatarFile = function(file, fileInput) {
        // Use jQuery simpleUpload plugin for compatibility with existing backend
        const $fileInput = $(fileInput);
        const $progressContainer = $('#upload-progress');
        const $progressBar = $('#progress-bar');
        const $progressText = $('#progress-text');
        const $messageContainer = $('.form-message');

        $fileInput.simpleUpload('/inc/ajax.ashx?action=change_avatar', {
          start: function (file) {
            // Show progress bar
            $progressContainer.show();
            $progressBar.css('width', '0%');
            $progressText.text('0%');

            // Clear previous messages
            $messageContainer.html('');
          },

          progress: function (progress) {
            // Update progress bar
            const progressPercent = Math.round(progress);
            $progressBar.css('width', progressPercent + '%');
            $progressText.text(progressPercent + '%');
          },

          success: function (data) {
            // Dispatch custom event for JS module to handle UI updates
            window.dispatchEvent(new CustomEvent('avatarUploadSuccess', {
              detail: { data }
            }));
          },

          error: function (error) {
            // Dispatch custom event for JS module to handle UI updates
            window.dispatchEvent(new CustomEvent('avatarUploadError', {
              detail: { error }
            }));
          },
        });
      };
    </script>

    <script type="module" src="/src/profile-main.js"></script>
  </body>
</html>
